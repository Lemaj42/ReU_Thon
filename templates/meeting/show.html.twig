{% extends 'base.html.twig' %}

{% block title %}Détails de la Réunion
{% endblock %}

{% block body %}
	<div class="container my-5">
		<h1 class="mb-4">Détails de la Réunion</h1>

		<div class="row">
			<div class="col-lg-8 mb-4">
				<article class="card">
					<div class="card-header">
						<h2 class="card-title h4 mb-0">{{ meeting.title }}</h2>
					</div>
					<div class="card-body">
						<h3 class="h5">Détails :</h3>
						<p>{{ meeting.detail }}</p>
						<ul class="list-unstyled">
							<li>
								<strong>Date principale :</strong>
								{{ meeting.date ? meeting.date|date('d/m/Y H:i') : 'Non définie' }}
							</li>
							{% if meeting.alternativeDate %}
								<li>
									<strong>Date alternative :</strong>
									{{ meeting.alternativeDate|date('d/m/Y H:i') }}
								</li>
							{% endif %}
							<li>
								<strong>Lieu :</strong>
								{{ meeting.place }}
							</li>
						</ul>
					</div>

					<div class="card-footer">
						{% if not hasVoted %}
							<form action="{{ path('app_meeting_vote', {'id': meeting.id}) }}" method="POST">
								<button type="submit" name="date" value="{{ meeting.date|date('Y-m-d H:i:s') }}" class="btn btn-primary">Choisir la date principale</button>
								{% if meeting.alternativeDate %}
									<button type="submit" name="date" value="{{ meeting.alternativeDate|date('Y-m-d H:i:s') }}" class="btn btn-secondary">Choisir la date alternative</button>
								{% endif %}
							</form>
						{% else %}
							<p>Vous avez déjà voté pour cette réunion. Date choisie :
								{{ chosenDate|date('d/m/Y H:i') }}</p>
						{% endif %}
					</div>
				</article>
			</div>

		</div>

		<div class="mt-4">
			<a href="{{ path('app_meeting_index') }}" class="btn btn-secondary">Retour à la liste</a>
			<a href="{{ path('app_meeting_edit', {'id': meeting.id}) }}" class="btn btn-primary">Modifier</a>
			{{ include('meeting/_delete_form.html.twig') }}
		</div>
		<div class="col-lg-4 mb-4">
			<div id="map"></div>
		</div>
	</div>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap" async defer></script>
	<script>
		function initMap() {
const address = "{{ meeting.place }}";
const geocoder = new google.maps.Geocoder();
const mapElement = document.getElementById('map');

mapElement.style.height = '300px'; // Définir une hauteur par défaut

geocoder.geocode({
address: address
}, function (results, status) {
if (status === 'OK') {
const map = new google.maps.Map(mapElement, {
zoom: 14,
center: results[0].geometry.location
});
new google.maps.Marker({map: map, position: results[0].geometry.location, title: "Lieu de la réunion"});
} else {
console.error('La géolocalisation de l\'adresse a échoué : ' + status);
mapElement.innerHTML = '<p>Impossible de charger la carte.</p>';
}
});
}
	</script>
{% endblock %}
