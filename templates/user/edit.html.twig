{% extends 'base.html.twig' %}

{% block title %}Modifier le profil
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" href="{{ asset('styles/Users/editProfile.css') }}">
{% endblock %}

{% block body %}
	<div class="user-edit-page">
		<div class="user-edit-container">
			<h1>Modification de profil</h1>

			<div class="user-edit-card">
				<div class="user-edit-card-header">
					<h2>Informations personnelles</h2>
				</div>
				<div class="user-edit-card-body">
					{{ form_start(form) }}
					<div class="user-edit-form-group">
						{{ form_label(form.firstname, null, {'label_attr': {'class': 'user-edit-form-label'}}) }}
						{{ form_widget(form.firstname, {'attr': {'class': 'user-edit-form-control'}}) }}
						{{ form_errors(form.firstname) }}
					</div>

					<div class="user-edit-form-group">
						{{ form_label(form.lastname, null, {'label_attr': {'class': 'user-edit-form-label'}}) }}
						{{ form_widget(form.lastname, {'attr': {'class': 'user-edit-form-control'}}) }}
						{{ form_errors(form.lastname) }}
					</div>

					<div class="user-edit-form-group">
						{{ form_label(form.email, null, {'label_attr': {'class': 'user-edit-form-label'}}) }}
						{{ form_widget(form.email, {'attr': {'class': 'user-edit-form-control'}}) }}
						{{ form_errors(form.email) }}
					</div>

					{% if app.user.id == user.id %}
						<div class="action-buttons mb-3">

							<div class="button-group">
								<button type="button" id="toggle-password" class="btn-details flex-grow">
									<i class="fas fa-key"></i>
									Modifier le mot de passe
								</button>
								<button type="button" id="delete-account-btn" class="btn-details btn-delete flex-grow">
									<i class="fas fa-trash-alt"></i>
									Supprimer mon compte
								</button>
							</div>
						</div>

						<div id="password-fields" style="display: none;">
							<div class="user-edit-form-group">
								{{ form_label(form.plainPassword.first, null, {'label_attr': {'class': 'user-edit-form-label'}}) }}
								<div class="password-input-group">
									{{ form_widget(form.plainPassword.first, {'attr': {'class': 'user-edit-form-control password-input'}}) }}
									<button type="button" class="toggle-password-visibility" data-target="{{ form.plainPassword.first.vars.id }}">
										<i class="fas fa-eye"></i>
									</button>
								</div>
								{{ form_errors(form.plainPassword.first) }}
							</div>

							<div class="user-edit-form-group">
								{{ form_label(form.plainPassword.second, null, {'label_attr': {'class': 'user-edit-form-label'}}) }}
								<div class="password-input-group">
									{{ form_widget(form.plainPassword.second, {'attr': {'class': 'user-edit-form-control password-input'}}) }}
									<button type="button" class="toggle-password-visibility" data-target="{{ form.plainPassword.second.vars.id }}">
										<i class="fas fa-eye"></i>
									</button>
								</div>
								{{ form_errors(form.plainPassword.second) }}
							</div>
						</div>
					{% endif %}

					<div class="action-buttons">
						<div class="button-group">
							<button type="submit" class="btn-details flex-grow">
								<i class="fas fa-save"></i>
								Enregistrer les modifications
							</button>
							{% if is_granted('ROLE_ADMIN') and app.user != user %}
								<a href="{{ path('app_user_index') }}" class="btn-details flex-grow">
									<i class="fas fa-arrow-left"></i>
									Retour à la liste des utilisateurs
								</a>
							{% else %}
								<a href="{{ path('app_user_profile', {'id': user.id}) }}" class="btn-details flex-grow">
									<i class="fas fa-arrow-left"></i>
									Retour au profil
								</a>
							{% endif %}

						</div>
					</div>
					{{ form_end(form) }}
				</div>
			</div>
		</div>
	</div>

	{% if app.user.id == user.id %}
		<div id="overlay" class="overlay d-none"></div>
		<div id="delete-confirmation" class="user-edit-card delete-confirmation d-none">
			<div class="user-edit-card-header">
				<h5>Confirmation de suppression</h5>
			</div>
			<div class="user-edit-card-body">
				<p>Êtes-vous sûr de vouloir supprimer votre compte ? Cette action est irréversible.</p>
				<div class="d-flex justify-content-end">
					<button id="cancel-delete" class="btn-details">Annuler</button>
					<form id="delete-account-form" method="post" action="{{ path('app_user_delete', {'id': user.id}) }}">
						<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ user.id) }}">
						<button type="submit" class="btn-details btn-delete">Confirmer la suppression</button>
					</form>
				</div>
			</div>
		</div>
	{% endif %}
{% endblock %}


{% block javascripts %}
	{{ parent() }}
	<script>
		document.addEventListener('DOMContentLoaded', function () {
var toggleButton = document.getElementById('toggle-password');
var passwordFields = document.getElementById('password-fields');
var deleteBtn = document.getElementById('delete-account-btn');
var deleteConfirmation = document.getElementById('delete-confirmation');
var cancelDeleteBtn = document.getElementById('cancel-delete');
var overlay = document.getElementById('overlay');

if (toggleButton && passwordFields) {
toggleButton.addEventListener('click', function () {
if (passwordFields.style.display === 'none') {
passwordFields.style.display = 'block';
this.innerHTML = '<i class="fas fa-times"></i> Annuler la modification du mot de passe';
} else {
passwordFields.style.display = 'none';
this.innerHTML = '<i class="fas fa-key"></i> Modifier le mot de passe';
}
});
}

var toggleVisibilityButtons = document.querySelectorAll('.toggle-password-visibility');
toggleVisibilityButtons.forEach(function (button) {
button.addEventListener('click', function () {
var targetId = this.getAttribute('data-target');
var passwordInput = document.getElementById(targetId);

if (passwordInput.type === 'password') {
passwordInput.type = 'text';
this.innerHTML = '<i class="fas fa-eye-slash"></i>';
} else {
passwordInput.type = 'password';
this.innerHTML = '<i class="fas fa-eye"></i>';
}
});
});

if (deleteBtn && deleteConfirmation && cancelDeleteBtn && overlay) {
deleteBtn.addEventListener('click', function () {
deleteConfirmation.classList.remove('d-none');
overlay.classList.remove('d-none');
});

cancelDeleteBtn.addEventListener('click', function () {
deleteConfirmation.classList.add('d-none');
overlay.classList.add('d-none');
});
}
});
	</script>
{% endblock %}
