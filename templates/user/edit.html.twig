{% extends 'base.html.twig' %}

{% block title %}Modifier mon profil
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" href="{{ asset('styles/Users/editProfile.css') }}">
{% endblock %}

{% block body %}
	<div id="overlay" class="overlay d-none"></div>
	<div class="container">
		<h1 class="Tittle">Modifier mon profil</h1>
		<div class="card">
			<div class="card-header">
				<h2 class="card-title">Informations personnelles</h2>
			</div>
			<div class="card-body">
				{{ form_start(form) }}
				<div class="form-group">
					{{ form_label(form.firstname) }}
					{{ form_widget(form.firstname, {'attr': {'class': 'form-control'}}) }}
					{{ form_errors(form.firstname) }}
				</div>

				<div class="form-group">
					{{ form_label(form.lastname) }}
					{{ form_widget(form.lastname, {'attr': {'class': 'form-control'}}) }}
					{{ form_errors(form.lastname) }}
				</div>

				<div class="form-group">
					{{ form_label(form.email) }}
					{{ form_widget(form.email, {'attr': {'class': 'form-control'}}) }}
					{{ form_errors(form.email) }}
				</div>

				<div class="action-buttons">
					<div class="button-group">
						<button type="button" id="toggle-password" class="btn-details flex-grow">
							<i class="fas fa-key"></i>
							Modifier le mot de passe
						</button>
						<button type="button" id="delete-account-btn" class="btn-details btn-delete flex-grow">
							<i class="fas fa-trash-alt"></i>
							Supprimer mon compte
						</button>

					</div>
				</div>

				<div id="password-fields" style="display: none;">
					<div class="form-group">
						{{ form_label(form.plainPassword.first) }}
						{{ form_widget(form.plainPassword.first, {'attr': {'class': 'form-control'}}) }}
						{{ form_errors(form.plainPassword.first) }}
					</div>

					<div class="form-group">
						{{ form_label(form.plainPassword.second) }}
						{{ form_widget(form.plainPassword.second, {'attr': {'class': 'form-control'}}) }}
						{{ form_errors(form.plainPassword.second) }}
					</div>
				</div>

				<div class="action-buttons">
					<div class="button-group">
						<button type="submit" class="btn-details flex-grow">
							<i class="fas fa-save"></i>
							Enregistrer les modifications
						</button>
						<a href="{{ path('app_user_profile', {'id': app.user.id}) }}" class="btn-details flex-grow">
							<i class="fas fa-arrow-left"></i>
							Retour au profil
						</a>
					</div>
				</div>
				{{ form_end(form) }}
			</div>
		</div>
	</div>

	<!-- Notification de suppression -->
	<div id="delete-confirmation" class="card delete-confirmation d-none">
		<div class="card-header">
			<h5>Confirmation de suppression</h5>
		</div>
		<div class="card-body">
			<p>Êtes-vous sûr de vouloir supprimer votre compte ? Cette action est irréversible.</p>
			<div class="d-flex justify-content-end">
				<button id="cancel-delete" class="btn-details">Annuler</button>
				<form id="delete-account-form" method="post" action="{{ path('app_user_delete', {'id': app.user.id}) }}">
					<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ app.user.id) }}">
					<button type="submit" class="btn-details">Confirmer la suppression</button>
				</form>
			</div>
		</div>
	</div>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script>
		document.addEventListener('DOMContentLoaded', function () { // Toggle password fields
var toggleButton = document.getElementById('toggle-password');
var passwordFields = document.getElementById('password-fields');

toggleButton.addEventListener('click', function () {
if (passwordFields.style.display === 'none') {
passwordFields.style.display = 'block';
toggleButton.innerHTML = '<i class="fas fa-times"></i> Annuler la modification du mot de passe';
} else {
passwordFields.style.display = 'none';
toggleButton.innerHTML = '<i class="fas fa-key"></i> Modifier le mot de passe';
}
});

// Delete account confirmation
var deleteBtn = document.getElementById('delete-account-btn');
var deleteConfirmation = document.getElementById('delete-confirmation');
var cancelDeleteBtn = document.getElementById('cancel-delete');
var overlay = document.getElementById('overlay');

deleteBtn.addEventListener('click', function () {
deleteConfirmation.classList.remove('d-none');
overlay.classList.remove('d-none');
});

cancelDeleteBtn.addEventListener('click', function () {
deleteConfirmation.classList.add('d-none');
overlay.classList.add('d-none');
});
});
	</script>
{% endblock %}
